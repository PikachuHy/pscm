# pscm_cc åŠŸèƒ½ç°çŠ¶ä¸å¼€å‘è§„åˆ’

æœ¬æ–‡æ¡£æ€»ç»“ pscm_cc çš„ç°æœ‰åŠŸèƒ½ç‰¹æ€§ï¼Œå¹¶è§„åˆ’å®ç°é©±åŠ¨ TeXmacs æ‰€éœ€çš„åŠŸèƒ½ã€‚

pscm_cc å·²å®ç° Scheme çš„æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
- âœ… å®Œæ•´çš„ç±»å‹ç³»ç»Ÿï¼ˆ19 ç§æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬ `MODULE`ï¼‰
- âœ… æ ¸å¿ƒç‰¹æ®Šå½¢å¼ï¼ˆåŒ…æ‹¬ `delay`/`force`ï¼‰
- âœ… Continuation æ”¯æŒ
- âœ… å®ç³»ç»Ÿï¼ˆæ”¯æŒ dotted pair å‚æ•°ï¼ŒåŒ…å« `macroexpand-1` å’Œ `macroexpand` è°ƒè¯•å·¥å…·ï¼‰
- âœ… æ¨¡å—ç³»ç»Ÿå’Œæ–‡ä»¶åŠ è½½ï¼ˆå®Œæ•´çš„æ¨¡å—å®šä¹‰ã€ä½¿ç”¨ã€å¯¼å‡ºå’Œæ–‡ä»¶åŠ è½½åŠŸèƒ½ï¼‰
- âœ… ä¸°å¯Œçš„å†…ç½®å‡½æ•°ï¼ˆåŒ…æ‹¬ `gcd`ã€`lcm`ï¼‰

## ä¸€ã€ç°æœ‰åŠŸèƒ½æ€»ç»“

### 1.1 æ ¸å¿ƒåŸºç¡€è®¾æ–½ âœ…

- **ç±»å‹ç³»ç»Ÿ**ï¼šç»Ÿä¸€ `SCM` ç±»å‹ï¼Œæ”¯æŒ 19 ç§æ•°æ®ç±»å‹ï¼ˆåŒ…æ‹¬ `PORT`ã€`PROMISE`ã€`MODULE`ï¼‰
- **è§£æå™¨**ï¼šé€’å½’ä¸‹é™è§£æå™¨ï¼Œæ”¯æŒå®Œæ•´ Scheme è¯­æ³•
- **æ±‚å€¼å™¨**ï¼šæ”¯æŒå°¾é€’å½’ä¼˜åŒ–ï¼Œæ¨¡å—åŒ–ç‰¹æ®Šå½¢å¼å¤„ç†
- **ç¯å¢ƒç³»ç»Ÿ**ï¼šè¯æ³•ä½œç”¨åŸŸï¼Œé“¾è¡¨ç»“æ„ç¯å¢ƒ
- **é”™è¯¯æŠ¥å‘Š**ï¼šæºä½ç½®è·Ÿè¸ªï¼Œæ¸…æ™°çš„é”™è¯¯ä¿¡æ¯

### 1.2 æ•°æ®ç±»å‹æ”¯æŒ âœ…

| ç±»å‹ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| `NIL` | âœ… | ç©ºåˆ—è¡¨ |
| `LIST` | âœ… | åˆ—è¡¨å’Œç‚¹å¯¹ |
| `NUM` | âœ… | æ•´æ•° |
| `FLOAT` | âœ… | æµ®ç‚¹æ•° |
| `RATIO` | âœ… | æœ‰ç†æ•°ï¼ˆåˆ†æ•°ï¼‰ |
| `CHAR` | âœ… | å­—ç¬¦ |
| `STR` | âœ… | å­—ç¬¦ä¸² |
| `SYM` | âœ… | ç¬¦å· |
| `BOOL` | âœ… | å¸ƒå°”å€¼ |
| `PROC` | âœ… | Scheme è¿‡ç¨‹ |
| `FUNC` | âœ… | C/C++ å‡½æ•° |
| `CONT` | âœ… | Continuation |
| `MACRO` | âœ… | å® |
| `HASH_TABLE` | âœ… | å“ˆå¸Œè¡¨ |
| `VECTOR` | âœ… | å‘é‡ |
| `PORT` | âœ… | ç«¯å£ |
| `PROMISE` | âœ… | Promiseï¼ˆå»¶è¿Ÿæ±‚å€¼ï¼‰ |
| `MODULE` | âœ… | æ¨¡å— |

### 1.3 ç‰¹æ®Šå½¢å¼æ”¯æŒ âœ…

- **å®šä¹‰**ï¼š`define`, `define-macro`, `lambda`, `set!`
- **æ§åˆ¶æµ**ï¼š`if`, `cond`ï¼ˆæ”¯æŒ `else` å’Œ `=>`ï¼‰, `case`, `and`, `or`, `begin`
- **ä½œç”¨åŸŸ**ï¼š`let`, `let*`, `letrec`ï¼ˆé€šè¿‡å®å±•å¼€ï¼‰
- **å¾ªç¯**ï¼š`do`, `for-each`, `map`
- **å¼•ç”¨**ï¼š`quote`, `quasiquote`
- **å‡½æ•°åº”ç”¨**ï¼š`apply`
- **Continuation**ï¼š`call/cc`, `call-with-current-continuation`
- **å¤šå€¼**ï¼š`call-with-values`, `values`
- **åŠ¨æ€æ§åˆ¶**ï¼š`dynamic-wind`
- **å»¶è¿Ÿæ±‚å€¼**ï¼š`delay`, `force`

### 1.4 å†…ç½®å‡½æ•°æ”¯æŒ âœ…

#### ç±»å‹æ£€æŸ¥
`procedure?`, `boolean?`, `null?`, `pair?`, `char?`, `number?`

#### åˆ—è¡¨æ“ä½œ
`car`, `cdr`, `cadr`, `cddr`, `caddr`, `cons`, `list`, `append`, `list-head`, `list-tail`, `last-pair`, `set-car!`, `set-cdr!`

#### æ•°å­—è¿ç®—
- ç®—æœ¯ï¼š`+`, `-`, `*`, `/`, `expt`, `abs`, `gcd`, `lcm`
- æ¯”è¾ƒï¼š`=`, `<`, `>`, `<=`, `>=`, `negative?`
- ç±»å‹æå‡ï¼šæ•´æ•°ã€æµ®ç‚¹æ•°ã€åˆ†æ•°æ··åˆè¿ç®—

#### å­—ç¬¦æ“ä½œ
`char?`, `char->integer`, `integer->char`, `char=?`, `char<?`, `char>?`, `char<=?`, `char>=?`, `char-upcase`, `char-downcase`

#### å­—ç¬¦ä¸²æ“ä½œ
`string-length`, `make-string`, `string-ref`, `string-set!`, `string=?`, `string<?`, `string<=?`, `substring`, `string-append`, `string->list`, `list->string`, `display`, `write`, `newline`

#### ç›¸ç­‰æ€§åˆ¤æ–­
`eq?`, `eqv?`, `equal?`

#### å…³è”åˆ—è¡¨
`assv`, `assoc`, `acons`, `assoc-ref`, `assoc-set!`, `assq-set!`, `assoc-remove!`

#### å“ˆå¸Œè¡¨
å®Œæ•´çš„å“ˆå¸Œè¡¨æ“ä½œé›†ï¼ˆåˆ›å»ºã€è®¾ç½®ã€è·å–ã€åˆ é™¤ã€éå†ï¼‰

#### ç«¯å£æ“ä½œ
`open-input-file`, `open-output-file`, `open-input-string`, `open-output-string`, `close-input-port`, `close-output-port`, `read`, `read-char`, `peek-char`, `write-char`, `eof-object?`, `char-ready?`, `input-port?`, `output-port?`, `get-output-string`, `call-with-input-file`, `call-with-output-file`, `call-with-input-string`, `call-with-output-string`, `make-soft-port`ï¼ˆè½¯ç«¯å£æ”¯æŒï¼‰

#### ç³»ç»Ÿæ“ä½œ
`exit`

#### é€‰é¡¹ç³»ç»Ÿ
- **Read Options**ï¼š`read-options-interface`, `read-set!`, `read-enable`, `read-disable` âœ…
- **Debug Options**ï¼š`debug-options-interface`, `debug-set!`, `debug-enable`, `debug-disable` âœ…

#### å»¶è¿Ÿæ±‚å€¼
`delay`, `force`

#### å®è°ƒè¯•å·¥å…·
`macroexpand-1`, `macroexpand`

#### å…¶ä»–
`gensym`, `not`, `eval`

### 1.5 C/C++ å‡½æ•°æ³¨å†Œ âœ…

- `scm_define_function`ï¼šå›ºå®šå‚æ•°å‡½æ•°
- `scm_define_generic_function`ï¼šæ³›å‹å‡½æ•°
- `scm_define_vararg_function`ï¼šå¯å˜å‚æ•°å‡½æ•°

### 1.6 å®ç³»ç»Ÿ âœ…

- **å®å®šä¹‰**ï¼š`define-macro` æ”¯æŒå®šä¹‰å®ï¼Œæ”¯æŒ dotted pair å‚æ•°åˆ—è¡¨ï¼ˆå¦‚ `(define-macro (foo x y . z) ...)`ï¼‰
- **å®å±•å¼€**ï¼šæ­£ç¡®å¤„ç†å®å‚æ•°ç»‘å®šå’Œå±•å¼€ï¼ŒåŒ…æ‹¬ rest å‚æ•°çš„ç»‘å®š
- **å®è°ƒè¯•å·¥å…·**ï¼š
  - `macroexpand-1 expr`ï¼šå±•å¼€å®ä¸€æ¬¡ï¼ˆå¦‚æœ `expr` æ˜¯å®è°ƒç”¨ï¼‰ï¼Œç±»ä¼¼ Guile 1.8 çš„ `macroexpand-1`
  - `macroexpand expr`ï¼šé€’å½’å±•å¼€å®ç›´åˆ°æ²¡æœ‰æ›´å¤šå®å¯å±•å¼€ï¼Œç±»ä¼¼ Guile 1.8 çš„ `macroexpand`
  - æ”¯æŒåœ¨æ¨¡å—ç¯å¢ƒä¸­æŸ¥æ‰¾å®ï¼Œæ­£ç¡®å¤„ç†ç”¨æˆ·å®šä¹‰çš„å®ï¼ˆå¦‚é‡æ–°å®šä¹‰çš„ `letrec`ï¼‰
- **Dotted Pair æ”¯æŒ**ï¼š
  - å®å±•å¼€æ—¶æ­£ç¡®ä¿ç•™ dotted pair ç»“æ„ï¼ˆ`is_dotted` æ ‡è®°ï¼‰
  - `expand_macros` å‡½æ•°åœ¨é€’å½’å±•å¼€åˆ—è¡¨æ—¶ä¿ç•™ `is_dotted` æ ‡è®°
  - `quasi` å‡½æ•°æ­£ç¡®å¤„ç† quasiquote ä¸­çš„ dotted pairï¼ŒåŒ…æ‹¬ `unquote-splicing` åè·Ÿ dotted pair çš„æƒ…å†µ
- **Quasiquote é›†æˆ**ï¼šå®ä¸­ä½¿ç”¨çš„ `quasiquote` æ­£ç¡®å¤„ç† dotted pairï¼Œç¡®ä¿ `(lambda (x y . z) z)` ç­‰ç»“æ„åœ¨å®å±•å¼€åä»ä¿æŒæ­£ç¡®
- **Unquote-splicing ä¿®å¤**ï¼šä¿®å¤äº† `unquote-splicing` (`,@`) åœ¨å¤„ç† dotted pair æ—¶çš„ BUGï¼Œç°åœ¨å¯ä»¥æ­£ç¡®å±•å¼€åŒ…å«å¤šä¸ªå…ƒç´ çš„åˆ—è¡¨ï¼ˆå¦‚ `letrec` å®ä¸­çš„å¤šä¸ª `set!` è¡¨è¾¾å¼ï¼‰
- **æµ‹è¯•è¦†ç›–**ï¼šåŒ…å« rest å‚æ•°å®ã€dotted pair å‚æ•°å®ã€quasiquote ä¸­ dotted pair çš„å®Œæ•´æµ‹è¯•

## äºŒã€ç¼ºå¤±åŠŸèƒ½åˆ†æ

### 3.1 ç«¯å£ï¼ˆPortï¼‰ç³»ç»Ÿ âœ…

**ä¼˜å…ˆçº§**ï¼šâœ… å·²å®Œæˆ

ç«¯å£ç³»ç»Ÿå·²å®Œæ•´å®ç°ï¼ŒåŒ…æ‹¬æ–‡ä»¶ç«¯å£å’Œå­—ç¬¦ä¸²ç«¯å£åŠŸèƒ½ã€‚

#### å·²å®ç°åŠŸèƒ½
- **ç«¯å£ç±»å‹**ï¼šè¾“å…¥ç«¯å£ã€è¾“å‡ºç«¯å£ âœ…
- **æ–‡ä»¶ç«¯å£**ï¼š
  - `open-input-file filename` â†’ è¾“å…¥ç«¯å£ âœ…
  - `open-output-file filename` â†’ è¾“å‡ºç«¯å£ âœ…
  - `close-input-port port` âœ…
  - `close-output-port port` âœ…
- **å­—ç¬¦ä¸²ç«¯å£**ï¼š
  - `open-input-string string` â†’ è¾“å…¥ç«¯å£ âœ…
  - `open-output-string` â†’ è¾“å‡ºç«¯å£ âœ…
  - `get-output-string port` â†’ å­—ç¬¦ä¸² âœ…
- **è½¯ç«¯å£ï¼ˆSoft Portï¼‰**ï¼š
  - `make-soft-port procedures modes` â†’ è‡ªå®šä¹‰ I/O ç«¯å£ âœ…
  - æ”¯æŒè‡ªå®šä¹‰å­—ç¬¦/å­—ç¬¦ä¸²è¾“å‡ºè¿‡ç¨‹ âœ…
  - æ”¯æŒè‡ªå®šä¹‰å­—ç¬¦è¯»å–è¿‡ç¨‹ âœ…
  - æ”¯æŒåˆ·æ–°å’Œå…³é—­è¿‡ç¨‹ âœ…
- **ç«¯å£æ“ä½œ**ï¼š
  - `read port`ï¼šä»ç«¯å£è¯»å– Scheme å¯¹è±¡ âœ…
  - `read-char port`ï¼šè¯»å–å­—ç¬¦ âœ…
  - `peek-char port`ï¼šæŸ¥çœ‹ä¸‹ä¸€ä¸ªå­—ç¬¦ âœ…
  - `eof-object? obj`ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºæ–‡ä»¶ç»“æŸå¯¹è±¡ âœ…
  - `char-ready? port`ï¼šåˆ¤æ–­å­—ç¬¦æ˜¯å¦å°±ç»ª âœ…
  - `write-char char port`ï¼šå†™å…¥å­—ç¬¦ âœ…
- **ç«¯å£è°“è¯**ï¼š
  - `input-port? port`ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºè¾“å…¥ç«¯å£ âœ…
  - `output-port? port`ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºè¾“å‡ºç«¯å£ âœ…
- **ç«¯å£åŒ…è£…**ï¼š
  - `call-with-input-file filename proc` âœ…
  - `call-with-output-file filename proc` âœ…
  - `call-with-input-string string proc` âœ…
  - `call-with-output-string proc` âœ…

### 3.2 æ–‡ä»¶åŠ è½½ç³»ç»Ÿ âœ…

**ä¼˜å…ˆçº§**ï¼šâœ… å·²å®Œæˆ

#### å·²å®ç°åŠŸèƒ½
- `parse_file`ï¼šè§£ææ–‡ä»¶ä¸º AST åˆ—è¡¨ âœ…
- `load filename`ï¼šåŠ è½½å¹¶æ‰§è¡Œ Scheme æ–‡ä»¶ âœ…
- `primitive-load filename`ï¼šåº•å±‚åŠ è½½å‡½æ•°ï¼ˆGuile å…¼å®¹ï¼‰âœ…
- åŠ è½½è·¯å¾„ç®¡ç†ï¼š`%load-path` æ”¯æŒè·¯å¾„æœç´¢ âœ…
- æ¨¡å—é›†æˆï¼šåŠ è½½æ–‡ä»¶æ—¶è‡ªåŠ¨å¤„ç† `define-module`ï¼Œæ”¯æŒæ¨¡å—æ–‡ä»¶è‡ªåŠ¨åŠ è½½ âœ…

#### å®ç°ç‰¹ç‚¹
1. âœ… `load` å‡½æ•°è°ƒç”¨ `parse_file` å¹¶é€ä¸ªæ±‚å€¼
2. âœ… æ”¯æŒç›¸å¯¹è·¯å¾„å’Œæœç´¢è·¯å¾„ï¼ˆé€šè¿‡ `%load-path`ï¼‰
3. âœ… é”™è¯¯å¤„ç†ï¼šæ–‡ä»¶ä¸å­˜åœ¨ã€è§£æé”™è¯¯ç­‰
4. âœ… `primitive-load` é‡æ„ä¸ºæ¥å— `const char *` å‚æ•°ï¼Œæä¾›æ›´å¥½çš„ C API å…¼å®¹æ€§
5. âœ… æå–å…¬å…±è¡¨è¾¾å¼æ±‚å€¼é€»è¾‘ï¼Œæé«˜ä»£ç å¤ç”¨æ€§

### 3.3 æ¨¡å—ç³»ç»Ÿ âœ…

**ä¼˜å…ˆçº§**ï¼šâœ… å·²å®Œæˆ

TeXmacs å¤§é‡ä½¿ç”¨æ¨¡å—ç³»ç»Ÿç»„ç»‡ä»£ç ã€‚

#### å·²å®ç°åŠŸèƒ½
- **æ¨¡å—å®šä¹‰**ï¼š
  - `define-module name`ï¼šå®šä¹‰æ¨¡å— âœ…
  - `current-module`ï¼šè·å–å½“å‰æ¨¡å— âœ…
- **æ¨¡å—ä½¿ç”¨**ï¼š
  - `use-modules spec ...`ï¼šä½¿ç”¨æ¨¡å— âœ…
  - `module-use! module spec`ï¼šæ¨¡å—æ“ä½œ âœ…
- **æ¨¡å—æŸ¥è¯¢**ï¼š
  - `resolve-module name`ï¼šè§£ææ¨¡å— âœ…
  - `module-ref module symbol`ï¼šè·å–æ¨¡å—å˜é‡ âœ…
  - `module-bound? module symbol`ï¼šæ£€æŸ¥æ¨¡å—ç»‘å®š âœ…
- **æ¨¡å—å¯¼å‡º**ï¼š
  - `define-public name value`ï¼šå®šä¹‰å¹¶å¯¼å‡º âœ…
  - `export symbol ...`ï¼šå¯¼å‡ºç¬¦å· âœ…
- **æ¨¡å—æ¥å£**ï¼š
  - æ¨¡å—ç¯å¢ƒç®¡ç†ï¼šæ¯ä¸ªæ¨¡å—æœ‰ç‹¬ç«‹ç¯å¢ƒ âœ…
  - æ¨¡å—è§£æï¼šæ”¯æŒæ¨¡å—è·¯å¾„æœç´¢ï¼ˆé€šè¿‡ `%load-path`ï¼‰âœ…

#### å®ç°ç‰¹ç‚¹
1. âœ… æ·»åŠ äº† `MODULE` ç±»å‹
2. âœ… æ¨¡å—ç¯å¢ƒç®¡ç†ï¼šæ¯ä¸ªæ¨¡å—æœ‰ç‹¬ç«‹ç¯å¢ƒ
3. âœ… æ¨¡å—è§£æï¼šæ”¯æŒæ¨¡å—è·¯å¾„æœç´¢
4. âœ… æ¨¡å—æŸ¥æ‰¾ï¼šæ”¯æŒä»æ¨¡å—çš„ `obarray`ã€`uses` åˆ—è¡¨å’Œæ ¹æ¨¡å—ä¸­æŸ¥æ‰¾å˜é‡

### 3.4 é”™è¯¯å¤„ç†æœºåˆ¶ âœ…

**ä¼˜å…ˆçº§**ï¼šâœ… å·²å®Œæˆ

#### å·²å®ç°åŠŸèƒ½
- `eval_error`ï¼šé”™è¯¯æŠ¥å‘Š âœ…
- æºä½ç½®è·Ÿè¸ª âœ…
- **è°ƒç”¨æ ˆè¿½è¸ª**ï¼šè‡ªåŠ¨è¿½è¸ªè¡¨è¾¾å¼æ±‚å€¼è·¯å¾„ï¼Œé”™è¯¯æ—¶æ˜¾ç¤ºå®Œæ•´è°ƒç”¨æ ˆï¼ˆæœ€å¤š 20 å±‚ï¼‰âœ…
- **å¢å¼ºçš„é”™è¯¯æŠ¥å‘Š**ï¼šåŒ…å«è¡¨è¾¾å¼ç±»å‹ã€å€¼ã€æºä½ç½®å’Œå®Œæ•´æ±‚å€¼ä¸Šä¸‹æ–‡ âœ…
- **å¼‚å¸¸æ•è·**ï¼š
  - `catch tag thunk handler`ï¼šæ•è·å¼‚å¸¸ âœ…
  - `throw key args ...`ï¼šæŠ›å‡ºå¼‚å¸¸ âœ…
  - `catch #t`ï¼šæ•è·æ‰€æœ‰å¼‚å¸¸ âœ…
- **é”™è¯¯æ¢å¤**ï¼š
  - `eval_error` å’Œ `type_error` ä½¿ç”¨ `scm_throw` æŠ›å‡ºå¼‚å¸¸ï¼Œå¯è¢« `catch` æ•è· âœ…
  - æœªæ•è·å¼‚å¸¸ç”± `scm_uncaught_throw` å¤„ç†ï¼ˆæ‰“å°é”™è¯¯ä¿¡æ¯åé€€å‡ºï¼‰âœ…

#### å®ç°ç»†èŠ‚
- åŸºäº `setjmp`/`longjmp` å®ç°éå±€éƒ¨è·³è½¬
- ä½¿ç”¨å…¨å±€ catch æ ˆï¼ˆ`g_catch_stack`ï¼‰ç®¡ç†æ´»è·ƒçš„ catch
- æ ‡å‡†é”™è¯¯æ ‡ç­¾ä¸ºç¬¦å· `"error"`ï¼ˆ`g_error_key`ï¼‰
- é”™è¯¯æ¶ˆæ¯æ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²ï¼ŒåŒ…è£…åœ¨ `(message)` åˆ—è¡¨ä¸­
- **é”™è¯¯å¤„ç†æ”¹è¿›**ï¼š
  - âœ… ä» `exit` æ”¹ä¸º `abort` ä»¥æ”¹å–„å †æ ˆè·Ÿè¸ªå¯è§æ€§
  - âœ… åœ¨å´©æºƒæ—¶æ‰“å° C++ å †æ ˆè·Ÿè¸ªå’Œ Scheme eval è°ƒç”¨æ ˆ
  - âœ… åœ¨ç¯å¢ƒæœç´¢é”™è¯¯ä¸­æ·»åŠ æºä½ç½®ä¸Šä¸‹æ–‡ä¿¡æ¯
  - âœ… æ”¯æŒ `wrong-number-of-args` é”™è¯¯æ•è·å’Œå¤„ç†

#### ç¼ºå¤±åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰
- **é”™è¯¯å¯¹è±¡**ï¼š
  - é”™è¯¯ç±»å‹ç³»ç»Ÿï¼ˆå½“å‰ä½¿ç”¨ç®€å•å­—ç¬¦ä¸²æ¶ˆæ¯ï¼‰
  - ç»“æ„åŒ–é”™è¯¯å¯¹è±¡ï¼ˆå½“å‰ä½¿ç”¨åˆ—è¡¨å­˜å‚¨é”™è¯¯ä¿¡æ¯ï¼‰

### 3.5 æ›´å¤šç‰¹æ®Šå½¢å¼ âœ…

**ä¼˜å…ˆçº§**ï¼šâœ… å·²å®Œæˆ

#### å·²å®ç°åŠŸèƒ½
- `case expr clause ...`ï¼šå¤šè·¯åˆ†æ”¯ âœ…
- `and expr ...`ï¼šé€»è¾‘ä¸ï¼ˆçŸ­è·¯æ±‚å€¼ï¼‰âœ…
- `or expr ...`ï¼šé€»è¾‘æˆ–ï¼ˆçŸ­è·¯æ±‚å€¼ï¼‰âœ…
- `delay expr`ï¼šå»¶è¿Ÿæ±‚å€¼ï¼ˆPromiseï¼‰âœ…
- `force promise`ï¼šå¼ºåˆ¶æ±‚å€¼ âœ…

#### å®ç°è¯´æ˜
- **Promise ç±»å‹**ï¼šæ·»åŠ äº† `PROMISE` ç±»å‹ï¼Œæ”¯æŒå»¶è¿Ÿæ±‚å€¼
- **é‡å…¥å¤„ç†**ï¼š`force` å®ç°æ­£ç¡®å¤„ç†é‡å…¥è°ƒç”¨ï¼ˆre-entrant forceï¼‰ï¼Œç¬¦åˆ R5RS è§„èŒƒ
- **æµ‹è¯•è¦†ç›–**ï¼šåŒ…å«åŸºç¡€ç”¨æ³•ã€å¤šæ¬¡ forceã€æ‡’åºåˆ—ï¼ˆstreamï¼‰å’Œé‡å…¥ force çš„å®Œæ•´æµ‹è¯•

### 3.6 æ›´å¤šå†…ç½®å‡½æ•° âš ï¸

**ä¼˜å…ˆçº§**ï¼šğŸŸ¢ ä½

#### å·²å®ç°åŠŸèƒ½
- **å­—ç¬¦æ“ä½œ**ï¼š
  - `char=?`, `char<?`, `char>?`, `char<=?`, `char>=?`ï¼šå­—ç¬¦æ¯”è¾ƒ âœ…
  - `char-upcase`, `char-downcase`ï¼šå¤§å°å†™è½¬æ¢ âœ…
- **å­—ç¬¦ä¸²æ“ä½œ**ï¼š
  - `string=?`, `string<?`, `string<=?`ï¼šå­—ç¬¦ä¸²æ¯”è¾ƒ âœ…
  - `substring`, `string-append`ï¼šå­—ç¬¦ä¸²æ“ä½œ âœ…
  - `string->list`, `list->string`ï¼šè½¬æ¢ âœ…
- **å‘é‡æ“ä½œ**ï¼š
  - `vector->list`, `list->vector`ï¼šè½¬æ¢ âœ…
- **æ•°å­—è¿ç®—**ï¼š
  - `gcd n1 ...`ï¼šæœ€å¤§å…¬çº¦æ•°ï¼ˆæ”¯æŒå¯å˜å‚æ•°ï¼‰âœ…
  - `lcm n1 ...`ï¼šæœ€å°å…¬å€æ•°ï¼ˆæ”¯æŒå¯å˜å‚æ•°ï¼‰âœ…
- **ç³»ç»Ÿæ“ä½œ**ï¼š
  - `exit code`ï¼šé€€å‡ºç¨‹åº âœ…

#### ç¼ºå¤±åŠŸèƒ½
- **ç³»ç»Ÿæ“ä½œ**ï¼š
  - `transcript-on filename`ï¼šå¼€å§‹è®°å½•
  - `transcript-off`ï¼šåœæ­¢è®°å½•

### 3.7 Guile API å…¼å®¹å±‚ âŒ

**ä¼˜å…ˆçº§**ï¼šğŸ”´ é«˜

TeXmacs é€šè¿‡ Guile C API ä¸ Scheme äº¤äº’ã€‚

#### ç¼ºå¤±åŠŸèƒ½
- **åŸºæœ¬æ“ä½œ**ï¼š
  ```c
  SCM scm_cons(SCM car, SCM cdr);
  SCM scm_car(SCM pair);
  SCM scm_cdr(SCM pair);
  SCM scm_list1(SCM obj1);
  SCM scm_list2(SCM obj1, SCM obj2);
  SCM scm_list3(SCM obj1, SCM obj2, SCM obj3);
  ```
- **æ±‚å€¼**ï¼š
  ```c
  SCM scm_eval(SCM expr, SCM env);
  SCM scm_eval_string(const char* str);
  SCM scm_eval_file(const char* filename);
  ```
- **ç¯å¢ƒ**ï¼š
  ```c
  SCM scm_interaction_environment();
  SCM scm_current_module();
  ```
- **å˜é‡æ“ä½œ**ï¼š
  ```c
  void scm_define(SCM env, SCM symbol, SCM value);
  SCM scm_lookup(SCM env, SCM symbol);
  ```
- **è¿‡ç¨‹è°ƒç”¨**ï¼š
  ```c
  SCM scm_call(SCM proc, SCM args);
  SCM scm_apply(SCM proc, SCM args);
  ```
- **é”™è¯¯å¤„ç†**ï¼š
  ```c
  void scm_error(const char* subr, const char* fmt, ...);
  SCM scm_catch(SCM tag, SCM* (*thunk)(void*), void* data,
                SCM* (*handler)(void*, SCM), void* handler_data);
  ```

#### å®ç°è¦ç‚¹
1. åˆ›å»º `guile_compat.h` å’Œ `guile_compat.cc`
2. ç±»å‹è½¬æ¢ï¼š`SCM*` â†” `SCM`ï¼ˆvoid*ï¼‰
3. API æ˜ å°„ï¼šå°†å†…éƒ¨å®ç°æ˜ å°„åˆ° Guile API
4. è¡Œä¸ºä¸€è‡´æ€§ï¼šç¡®ä¿ä¸ Guile 1.8 è¡Œä¸ºä¸€è‡´

### 2.8 åƒåœ¾å›æ”¶ï¼ˆGCï¼‰âŒ

**ä¼˜å…ˆçº§**ï¼šğŸ”´ é«˜

å½“å‰æ‰€æœ‰å†…å­˜éƒ½ä¸ä¼šé‡Šæ”¾ï¼Œå­˜åœ¨å†…å­˜æ³„æ¼ã€‚

#### å®ç°æ–¹æ¡ˆ
1. **æ ‡è®°-æ¸…é™¤ï¼ˆMark-and-Sweepï¼‰**ï¼š
   - æ ‡è®°æ‰€æœ‰å¯è¾¾å¯¹è±¡
   - æ¸…é™¤æœªæ ‡è®°å¯¹è±¡
2. **æ ¹å¯¹è±¡æ³¨å†Œ**ï¼š
   - å…¨å±€ç¯å¢ƒ
   - Continuation æ ˆ
   - å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡
3. **å¯¹è±¡éå†**ï¼š
   - é€’å½’éå†æ‰€æœ‰å¼•ç”¨
   - æ ‡è®°å¯è¾¾å¯¹è±¡

#### å®ç°è¦ç‚¹
1. ç»Ÿä¸€å†…å­˜åˆ†é…æ¥å£
2. å¯¹è±¡æ ‡è®°æœºåˆ¶
3. GC è§¦å‘æ—¶æœºï¼ˆåˆ†é…æ—¶ã€æ‰‹åŠ¨è§¦å‘ï¼‰
4. ä¸ continuation çš„å…¼å®¹æ€§

### 2.9 æ€§èƒ½ä¼˜åŒ– âš ï¸

**ä¼˜å…ˆçº§**ï¼šğŸŸ¢ ä½

#### å½“å‰é—®é¢˜
- ç¯å¢ƒæŸ¥æ‰¾ï¼šO(n) çº¿æ€§æœç´¢
- ç¬¦å·æ¯”è¾ƒï¼šä½¿ç”¨ `memcmp`

#### ä¼˜åŒ–æ–¹å‘
1. **ç¯å¢ƒæŸ¥æ‰¾ä¼˜åŒ–**ï¼š
   - ä½¿ç”¨å“ˆå¸Œè¡¨ä¼˜åŒ–ç¯å¢ƒæŸ¥æ‰¾ï¼ˆå“ˆå¸Œè¡¨å·²å®ç°ï¼‰
   - å°†æŸ¥æ‰¾å¤æ‚åº¦é™è‡³ O(1)
2. **ç¬¦å·è¡¨ä¼˜åŒ–**ï¼š
   - ç¬¦å·å»é‡ï¼ˆinterningï¼‰
   - å¿«é€Ÿç¬¦å·æ¯”è¾ƒ
3. **å…¶ä»–ä¼˜åŒ–**ï¼š
   - çƒ­ç‚¹ä»£ç è¯†åˆ«
   - å°¾è°ƒç”¨ä¼˜åŒ–æ”¹è¿›

